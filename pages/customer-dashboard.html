<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <title>My Dashboard - Raj Marketing | Customer Portal</title>
  
  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- FullCalendar -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
  
  <!-- Leaflet Maps -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      min-height: 100vh;
    }

    /* Main Container */
    .dashboard-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      position: relative;
    }

    /* Header */
    .header {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 15px 25px;
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo i {
      font-size: 2rem;
      color: white;
    }

    .logo span {
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .notification-bell {
      position: relative;
      cursor: pointer;
    }

    .notification-bell i {
      font-size: 1.5rem;
      color: white;
    }

    .badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ff4757;
      color: white;
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 50%;
    }

    .logout-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 8px 20px;
      border-radius: 30px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .logout-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* Profile Section */
    .profile-section {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 30px;
      padding: 30px;
      margin-bottom: 30px;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .profile-cover {
      height: 200px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 20px;
      position: relative;
      margin-bottom: 60px;
      overflow: hidden;
    }

    .cover-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0.3;
    }

    .cover-edit {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 8px 15px;
      border-radius: 30px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .profile-info {
      position: relative;
      display: flex;
      align-items: flex-end;
      gap: 30px;
      margin-top: -60px;
      padding: 0 30px;
    }

    .profile-avatar {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      border: 5px solid white;
      overflow: hidden;
      cursor: pointer;
      position: relative;
    }

    .profile-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .avatar-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      text-align: center;
      padding: 10px;
      font-size: 0.8rem;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .profile-avatar:hover .avatar-overlay {
      opacity: 1;
    }

    .profile-details {
      flex: 1;
      color: white;
    }

    .profile-details h2 {
      font-size: 2rem;
      margin-bottom: 10px;
    }

    .profile-stats {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 5px;
      background: rgba(255, 255, 255, 0.2);
      padding: 8px 15px;
      border-radius: 30px;
      font-size: 0.9rem;
    }

    .stat-item i {
      color: #f0b202;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 25px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      text-align: center;
    }

    .stat-card h3 {
      font-size: 2rem;
      margin-bottom: 5px;
    }

    .stat-card p {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    /* Service Grid */
    .service-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-bottom: 30px;
    }

    .service-btn {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 15px;
      padding: 20px;
      color: white;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }

    .service-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-5px);
    }

    .service-btn i {
      font-size: 2rem;
      color: #f0b202;
      margin-bottom: 10px;
    }

    .service-btn span {
      display: block;
      font-size: 0.9rem;
    }

    /* Dashboard Grid */
    .dashboard-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
    }

    .card {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 25px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      margin-bottom: 20px;
      color: white;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .card-header h3 {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-header i {
      color: #f0b202;
    }

    /* Order Tracking */
    .order-item {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .order-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .order-id {
      font-weight: 600;
      color: #f0b202;
    }

    .order-status {
      background: rgba(240, 178, 2, 0.2);
      padding: 3px 10px;
      border-radius: 30px;
      font-size: 0.8rem;
    }

    .order-progress {
      display: flex;
      justify-content: space-between;
      margin: 20px 0;
      position: relative;
    }

    .order-progress::before {
      content: '';
      position: absolute;
      top: 15px;
      left: 0;
      right: 0;
      height: 2px;
      background: rgba(255, 255, 255, 0.2);
      z-index: 1;
    }

    .progress-step {
      position: relative;
      z-index: 2;
      text-align: center;
      flex: 1;
    }

    .step-dot {
      width: 30px;
      height: 30px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      margin: 0 auto 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid transparent;
    }

    .step-dot.completed {
      background: #4cd964;
      border-color: white;
    }

    .step-dot.active {
      background: #f0b202;
      border-color: white;
    }

    .step-label {
      font-size: 0.7rem;
    }

    .order-actions {
      display: flex;
      gap: 10px;
    }

    .order-actions button {
      flex: 1;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 8px;
      border-radius: 30px;
      cursor: pointer;
      font-size: 0.8rem;
    }

    .order-actions button:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* Map */
    #map {
      height: 200px;
      border-radius: 15px;
      margin: 15px 0;
    }

    /* Payment Methods */
    .payment-methods {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin: 15px 0;
    }

    .payment-method {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      cursor: pointer;
    }

    .payment-method:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .payment-method i {
      font-size: 2rem;
      color: #f0b202;
      margin-bottom: 5px;
    }

    .payment-method span {
      display: block;
      font-size: 0.8rem;
    }

    /* Appointment Calendar */
    #calendar {
      background: white;
      border-radius: 15px;
      padding: 15px;
      color: #333;
    }

    /* Service List */
    .service-list {
      max-height: 300px;
      overflow-y: auto;
    }

    .service-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .service-icon {
      width: 40px;
      height: 40px;
      background: rgba(240, 178, 2, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .service-icon i {
      color: #f0b202;
    }

    .service-details {
      flex: 1;
    }

    .service-details h4 {
      font-size: 1rem;
      margin-bottom: 3px;
    }

    .service-details p {
      font-size: 0.8rem;
      opacity: 0.8;
    }

    .service-status {
      font-size: 0.8rem;
      padding: 3px 10px;
      border-radius: 30px;
    }

    .status-completed {
      background: rgba(76, 217, 100, 0.2);
      color: #4cd964;
    }

    .status-pending {
      background: rgba(240, 178, 2, 0.2);
      color: #f0b202;
    }

    /* Complaint Form */
    .complaint-form {
      display: none;
    }

    .complaint-form.active {
      display: block;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-size: 0.9rem;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      color: white;
      font-family: 'Poppins', sans-serif;
    }

    .form-group textarea {
      height: 100px;
      resize: vertical;
    }

    .btn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      border: none;
      color: white;
      padding: 12px 25px;
      border-radius: 30px;
      cursor: pointer;
      font-size: 1rem;
      width: 100%;
    }

    .btn:hover {
      background: linear-gradient(135deg, #764ba2, #667eea);
    }

    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 30px;
      padding: 40px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-header h2 {
      color: white;
    }

    .modal-close {
      background: none;
      border: none;
      color: white;
      font-size: 2rem;
      cursor: pointer;
    }

    .animal-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }

    .animal-option {
      text-align: center;
      cursor: pointer;
      padding: 15px;
      border-radius: 15px;
      transition: all 0.3s;
    }

    .animal-option:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .animal-emoji {
      font-size: 3rem;
      margin-bottom: 10px;
    }

    .animal-name {
      color: white;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 15px 25px;
      border-radius: 50px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      transform: translateX(400px);
      transition: all 0.3s;
      z-index: 9999;
      border-left: 5px solid #f0b202;
    }

    .toast.show {
      transform: translateX(0);
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .service-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .profile-info {
        flex-direction: column;
        align-items: center;
        text-align: center;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .service-grid {
        grid-template-columns: 1fr;
      }
      
      .animal-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <i class="fas fa-shield-alt"></i>
        <span>Raj Marketing</span>
      </div>
      <div class="header-actions">
        <div class="notification-bell" onclick="showNotifications()">
          <i class="fas fa-bell"></i>
          <span class="badge" id="notificationCount">0</span>
        </div>
        <button class="logout-btn" onclick="logout()">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </header>

    <!-- Profile Section -->
    <div class="profile-section">
      <div class="profile-cover" id="coverContainer">
        <img src="" alt="Cover" class="cover-image" id="coverImage" style="display: none;">
        <button class="cover-edit" onclick="changeCover()">
          <i class="fas fa-camera"></i> Change Cover
        </button>
      </div>

      <div class="profile-info">
        <div class="profile-avatar" onclick="openAvatarModal()">
          <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=default" alt="Avatar" id="avatarImage">
          <div class="avatar-overlay">
            <i class="fas fa-camera"></i> Change
          </div>
        </div>

        <div class="profile-details">
          <h2 id="customerName">Loading...</h2>
          <div class="profile-stats">
            <div class="stat-item">
              <i class="fas fa-id-card"></i>
              <span id="customerId">CUST001</span>
            </div>
            <div class="stat-item">
              <i class="fas fa-phone"></i>
              <span id="customerPhone">+91-9876543210</span>
            </div>
            <div class="stat-item">
              <i class="fas fa-map-marker-alt"></i>
              <span id="customerAddress">Mysore</span>
            </div>
            <div class="stat-item">
              <i class="fas fa-calendar"></i>
              <span id="memberSince">Jan 2024</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card">
        <h3 id="totalOrders">0</h3>
        <p>Total Orders</p>
      </div>
      <div class="stat-card">
        <h3 id="activeOrders">0</h3>
        <p>Active Orders</p>
      </div>
      <div class="stat-card">
        <h3 id="completedOrders">0</h3>
        <p>Completed</p>
      </div>
      <div class="stat-card">
        <h3 id="loyaltyPoints">0</h3>
        <p>Loyalty Points</p>
      </div>
    </div>

    <!-- Service Grid -->
    <div class="service-grid">
      <div class="service-btn" onclick="showSection('newOrder')">
        <i class="fas fa-shopping-cart"></i>
        <span>New Order</span>
      </div>
      <div class="service-btn" onclick="showSection('trackOrders')">
        <i class="fas fa-map-marker-alt"></i>
        <span>Track Orders</span>
      </div>
      <div class="service-btn" onclick="showSection('payments')">
        <i class="fas fa-credit-card"></i>
        <span>Payments</span>
      </div>
      <div class="service-btn" onclick="showSection('appointments')">
        <i class="fas fa-calendar-check"></i>
        <span>Appointments</span>
      </div>
      <div class="service-btn" onclick="showSection('services')">
        <i class="fas fa-tools"></i>
        <span>Services</span>
      </div>
      <div class="service-btn" onclick="showSection('complaints')">
        <i class="fas fa-exclamation-triangle"></i>
        <span>Complaints</span>
      </div>
      <div class="service-btn" onclick="showSection('loyalty')">
        <i class="fas fa-gift"></i>
        <span>Loyalty</span>
      </div>
      <div class="service-btn" onclick="showSection('referrals')">
        <i class="fas fa-users"></i>
        <span>Referrals</span>
      </div>
    </div>

    <!-- Dashboard Grid -->
    <div class="dashboard-grid">
      <!-- Left Column - Orders -->
      <div>
        <!-- New Order Form -->
        <div class="card" id="newOrderCard" style="display: none;">
          <div class="card-header">
            <h3><i class="fas fa-shopping-cart"></i> Place New Order</h3>
          </div>
          <form id="orderForm">
            <div class="form-group">
              <label>Product Type</label>
              <select id="productType" required>
                <option value="">Select Product</option>
                <option value="Fiberglass Window Net">Fiberglass Window Net - ‚Çπ399/sq ft</option>
                <option value="Aluminum Frame Net">Aluminum Frame Net - ‚Çπ599/sq ft</option>
                <option value="Magnetic Door Net">Magnetic Door Net - ‚Çπ899/sq ft</option>
                <option value="Sliding Door Net">Sliding Door Net - ‚Çπ999/sq ft</option>
              </select>
            </div>
            <div class="form-group">
              <label>Quantity (sq ft)</label>
              <input type="number" id="quantity" min="1" value="10" required>
            </div>
            <div class="form-group">
              <label>Location</label>
              <select id="location" required>
                <option value="">Select Area</option>
                <option value="Hootgalli">Hootgalli</option>
                <option value="Kuvempunagar">Kuvempunagar</option>
                <option value="Vijayanagar">Vijayanagar</option>
                <option value="Gokulam">Gokulam</option>
                <option value="Jayalakshmipuram">Jayalakshmipuram</option>
              </select>
            </div>
            <div class="form-group">
              <label>Full Address</label>
              <textarea id="address" required></textarea>
            </div>
            <div class="form-group">
              <label>Preferred Date</label>
              <input type="date" id="orderDate" required>
            </div>
            <button type="submit" class="btn">Place Order</button>
          </form>
        </div>

             <!-- Track Orders -->
        <div class="card" id="trackOrdersCard">
          <div class="card-header">
            <h3><i class="fas fa-map-marker-alt"></i> Track Your Orders</h3>
            <button class="btn" style="width: auto; padding: 5px 15px;" onclick="refreshOrders()">
              <i class="fas fa-sync-alt"></i> Refresh
            </button>
          </div>
          <div id="ordersList"></div>
        </div>

        <!-- Live Map (Shows when tracking) -->
        <div class="card" id="mapCard" style="display: none;">
          <div class="card-header">
            <h3><i class="fas fa-map"></i> Live Location</h3>
          </div>
          <div id="map"></div>
          <p style="margin-top: 10px; font-size: 0.9rem;" id="etaInfo"></p>
        </div>
      </div>

      <!-- Right Column - Other Services -->
      <div>
        <!-- Payments -->
        <div class="card" id="paymentsCard" style="display: none;">
          <div class="card-header">
            <h3><i class="fas fa-credit-card"></i> Make Payment</h3>
          </div>
          <div id="pendingPayments"></div>
          
          <div class="payment-methods">
            <div class="payment-method" onclick="processPayment('gpay')">
              <i class="fab fa-google-pay"></i>
              <span>Google Pay</span>
            </div>
            <div class="payment-method" onclick="processPayment('phonepe')">
              <i class="fas fa-mobile-alt"></i>
              <span>PhonePe</span>
            </div>
            <div class="payment-method" onclick="processPayment('paytm')">
              <i class="fas fa-rupee-sign"></i>
              <span>Paytm</span>
            </div>
            <div class="payment-method" onclick="processPayment('card')">
              <i class="fas fa-credit-card"></i>
              <span>Credit Card</span>
            </div>
          </div>

          <div id="paymentHistory" style="margin-top: 20px;"></div>
        </div>

        <!-- Appointments -->
        <div class="card" id="appointmentsCard" style="display: none;">
          <div class="card-header">
            <h3><i class="fas fa-calendar-check"></i> Schedule Appointment</h3>
          </div>
          <div id="calendar"></div>
          
          <form id="appointmentForm" style="margin-top: 20px;">
            <div class="form-group">
              <label>Date</label>
              <input type="date" id="appointmentDate" required>
            </div>
            <div class="form-group">
              <label>Time</label>
              <select id="appointmentTime" required>
                <option value="">Select Time</option>
                <option value="09:00">09:00 AM</option>
                <option value="10:00">10:00 AM</option>
                <option value="11:00">11:00 AM</option>
                <option value="14:00">02:00 PM</option>
                <option value="15:00">03:00 PM</option>
                <option value="16:00">04:00 PM</option>
              </select>
            </div>
            <div class="form-group">
              <label>Purpose</label>
              <select id="purpose" required>
                <option value="Installation">New Installation</option>
                <option value="Measurement">Site Measurement</option>
                <option value="Repair">Repair Service</option>
                <option value="Consultation">Consultation</option>
              </select>
            </div>
            <button type="submit" class="btn">Book Appointment</button>
          </form>
          <div id="upcomingAppointments" style="margin-top: 20px;"></div>
        </div>

        <!-- Services -->
        <div class="card" id="servicesCard" style="display: none;">
          <div class="card-header">
            <h3><i class="fas fa-tools"></i> Service History</h3>
          </div>
          <div class="service-list" id="serviceHistory"></div>
          
          <button class="btn" style="margin-top: 15px;" onclick="requestQuickService()">
            Request Quick Service
          </button>
        </div>

        <!-- Complaints -->
        <div class="card" id="complaintsCard" style="display: none;">
          <div class="card-header">
            <h3><i class="fas fa-exclamation-triangle"></i> Register Complaint</h3>
          </div>
          
          <form id="complaintForm">
            <div class="form-group">
              <label>Order ID (Optional)</label>
              <input type="text" id="complaintOrder" placeholder="Enter order ID if applicable">
            </div>
            <div class="form-group">
              <label>Complaint Type</label>
              <select id="complaintType" required>
                <option value="">Select Type</option>
                <option value="Quality">Quality Issue</option>
                <option value="Installation">Installation Problem</option>
                <option value="Delay">Delay in Service</option>
                <option value="Damage">Product Damage</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div class="form-group">
              <label>Description</label>
              <textarea id="complaintDesc" required></textarea>
            </div>
            <div class="form-group">
              <label>Priority</label>
              <select id="priority">
                <option value="Low">Low</option>
                <option value="Medium" selected>Medium</option>
                <option value="High">High</option>
              </select>
            </div>
            <button type="submit" class="btn">Submit Complaint</button>
          </form>

          <div id="complaintHistory" style="margin-top: 20px;"></div>
        </div>

        <!-- Loyalty -->
        <div class="card" id="loyaltyCard" style="display: none;">
          <div class="card-header">
            <h3><i class="fas fa-gift"></i> Loyalty Program</h3>
          </div>
          <div style="text-align: center;">
            <h2 id="loyaltyPointsDisplay">0</h2>
            <p>Available Points</p>
            <div style="background: rgba(255,255,255,0.1); height: 10px; border-radius: 10px; margin: 15px 0;">
              <div id="tierProgress" style="width: 0%; height: 100%; background: #f0b202; border-radius: 10px;"></div>
            </div>
            <p id="currentTier">Bronze Tier</p>
            <button class="btn" onclick="redeemPoints()" id="redeemBtn">Redeem Points</button>
          </div>
        </div>

        <!-- Referrals -->
        <div class="card" id="referralsCard" style="display: none;">
          <div class="card-header">
            <h3><i class="fas fa-users"></i> Refer & Earn</h3>
          </div>
          <div style="text-align: center;">
            <h2 id="referralCode">RAJ1234</h2>
            <button class="btn" onclick="copyReferral()" style="margin: 10px 0;">
              <i class="fas fa-copy"></i> Copy Code
            </button>
            <p id="referralEarnings">Earned: ‚Çπ0</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Avatar Modal -->
  <div class="modal" id="avatarModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Choose Your Avatar</h2>
        <button class="modal-close" onclick="closeModal('avatarModal')">&times;</button>
      </div>
      <div class="animal-grid">
        <div class="animal-option" onclick="selectAvatar('lion')">
          <div class="animal-emoji">ü¶Å</div>
          <div class="animal-name">Lion</div>
        </div>
        <div class="animal-option" onclick="selectAvatar('elephant')">
          <div class="animal-emoji">üêò</div>
          <div class="animal-name">Elephant</div>
        </div>
        <div class="animal-option" onclick="selectAvatar('giraffe')">
          <div class="animal-emoji">ü¶í</div>
          <div class="animal-name">Giraffe</div>
        </div>
        <div class="animal-option" onclick="selectAvatar('monkey')">
          <div class="animal-emoji">üêí</div>
          <div class="animal-name">Monkey</div>
        </div>
        <div class="animal-option" onclick="selectAvatar('panda')">
          <div class="animal-emoji">üêº</div>
          <div class="animal-name">Panda</div>
        </div>
        <div class="animal-option" onclick="selectAvatar('tiger')">
          <div class="animal-emoji">üêØ</div>
          <div class="animal-name">Tiger</div>
        </div>
        <div class="animal-option" onclick="selectAvatar('fox')">
          <div class="animal-emoji">ü¶ä</div>
          <div class="animal-name">Fox</div>
        </div>
        <div class="animal-option" onclick="selectAvatar('wolf')">
          <div class="animal-emoji">üê∫</div>
          <div class="animal-name">Wolf</div>
        </div>
        <div class="animal-option" onclick="selectAvatar('cat')">
          <div class="animal-emoji">üê±</div>
          <div class="animal-name">Cat</div>
        </div>
      </div>
      <button class="btn" onclick="uploadPhoto()" style="margin-top: 20px;">
        <i class="fas fa-upload"></i> Upload Photo
      </button>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <!-- Scripts -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>

  <script>
    // ===== DATA STORAGE =====
    let currentUser = null;
    let orders = [];
    let payments = [];
    let appointments = [];
    let services = [];
    let complaints = [];
    let map = null;
    let calendar = null;

    // ===== INITIALIZATION =====
    document.addEventListener('DOMContentLoaded', function() {
      // Check login
      const userData = localStorage.getItem('currentUser') || sessionStorage.getItem('currentUser');
      if (!userData) {
        window.location.href = 'customer-login.html';
        return;
      }

      currentUser = JSON.parse(userData);
      if (currentUser.type !== 'customer') {
        window.location.href = 'customer-login.html';
        return;
      }

      // Load user data
      loadUserData();
      
      // Load all data from localStorage
      loadAllData();
      
      // Show default section
      showSection('trackOrders');
      
      // Initialize calendar
      initCalendar();
    });

    // ===== LOAD USER DATA =====
    function loadUserData() {
      document.getElementById('customerName').textContent = currentUser.name || 'Customer';
      document.getElementById('customerId').textContent = currentUser.id || 'CUST' + Date.now();
      document.getElementById('customerPhone').textContent = currentUser.phone || '+91-9876543210';
      document.getElementById('customerAddress').textContent = currentUser.address || 'Mysore';
      document.getElementById('memberSince').textContent = currentUser.joinDate || 'Jan 2024';
      
      if (currentUser.avatar) {
        document.getElementById('avatarImage').src = currentUser.avatar;
      }
      
      if (currentUser.cover) {
        document.getElementById('coverImage').src = currentUser.cover;
        document.getElementById('coverImage').style.display = 'block';
      }
    }

    // ===== LOAD ALL DATA FROM STORAGE =====
    function loadAllData() {
      // Load orders
      const savedOrders = localStorage.getItem(`orders_${currentUser.id}`);
      orders = savedOrders ? JSON.parse(savedOrders) : [];
      
      // Load payments
      const savedPayments = localStorage.getItem(`payments_${currentUser.id}`);
      payments = savedPayments ? JSON.parse(savedPayments) : [];
      
      // Load appointments
      const savedAppointments = localStorage.getItem(`appointments_${currentUser.id}`);
      appointments = savedAppointments ? JSON.parse(savedAppointments) : [];
      
      // Load services
      const savedServices = localStorage.getItem(`services_${currentUser.id}`);
      services = savedServices ? JSON.parse(savedServices) : [];
      
      // Load complaints
      const savedComplaints = localStorage.getItem(`complaints_${currentUser.id}`);
      complaints = savedComplaints ? JSON.parse(savedComplaints) : [];
      
      // Update UI
      updateStats();
      displayOrders();
      displayPendingPayments();
      displayUpcomingAppointments();
      displayServiceHistory();
      displayComplaintHistory();
      updateLoyalty();
    }

    // ===== UPDATE STATS =====
    function updateStats() {
      const total = orders.length;
      const active = orders.filter(o => o.status !== 'completed' && o.status !== 'cancelled').length;
      const completed = orders.filter(o => o.status === 'completed').length;
      
      document.getElementById('totalOrders').textContent = total;
      document.getElementById('activeOrders').textContent = active;
      document.getElementById('completedOrders').textContent = completed;
      
      // Loyalty points (100 points per order)
      const points = completed * 100;
      document.getElementById('loyaltyPoints').textContent = points;
      document.getElementById('loyaltyPointsDisplay').textContent = points;
      
      // Tier based on points
      let tier = 'Bronze';
      let progress = (points / 1000) * 100;
      if (points >= 2000) {
        tier = 'Platinum';
        progress = 100;
      } else if (points >= 1000) {
        tier = 'Gold';
        progress = (points / 2000) * 100;
      } else if (points >= 500) {
        tier = 'Silver';
        progress = (points / 1000) * 100;
      }
      
      document.getElementById('currentTier').textContent = tier + ' Tier';
      document.getElementById('tierProgress').style.width = progress + '%';
      
      // Notification count
      const unread = complaints.filter(c => !c.read).length;
      document.getElementById('notificationCount').textContent = unread;
    }

    // ===== DISPLAY ORDERS =====
    function displayOrders() {
      const container = document.getElementById('ordersList');
      
      if (orders.length === 0) {
        container.innerHTML = '<p style="text-align: center; padding: 20px;">No orders yet. Place your first order!</p>';
        return;
      }
      
      container.innerHTML = orders.map(order => `
        <div class="order-item">
          <div class="order-header">
            <span class="order-id">${order.id}</span>
            <span class="order-status">${order.status}</span>
          </div>
          <p>${order.product} ‚Ä¢ ${order.quantity} sq ft</p>
          <p>üìç ${order.location} ‚Ä¢ üìÖ ${order.date}</p>
          <p>üí∞ ‚Çπ${order.total}</p>
          
          <div class="order-progress">
            <div class="progress-step">
              <div class="step-dot ${order.status !== 'pending' ? 'completed' : ''}">
                <i class="fas fa-check"></i>
              </div>
              <span class="step-label">Ordered</span>
            </div>
            <div class="progress-step">
              <div class="step-dot ${order.status === 'processing' || order.status === 'dispatched' || order.status === 'completed' ? 'completed' : ''} ${order.status === 'processing' ? 'active' : ''}">
                <i class="fas fa-cog"></i>
              </div>
              <span class="step-label">Processing</span>
            </div>
            <div class="progress-step">
              <div class="step-dot ${order.status === 'dispatched' || order.status === 'completed' ? 'completed' : ''} ${order.status === 'dispatched' ? 'active' : ''}">
                <i class="fas fa-truck"></i>
              </div>
              <span class="step-label">Dispatched</span>
            </div>
            <div class="progress-step">
              <div class="step-dot ${order.status === 'completed' ? 'completed' : ''}">
                <i class="fas fa-check-circle"></i>
              </div>
              <span class="step-label">Delivered</span>
            </div>
          </div>
          
          <div class="order-actions">
            ${order.status === 'dispatched' ? 
              `<button onclick="trackOrder('${order.id}')">
                <i class="fas fa-map-marker-alt"></i> Track
              </button>` : ''}
            ${order.status === 'pending' ? 
              `<button onclick="cancelOrder('${order.id}')">
                <i class="fas fa-times"></i> Cancel
              </button>` : ''}
            <button onclick="viewOrderDetails('${order.id}')">
              <i class="fas fa-eye"></i> Details
            </button>
          </div>
        </div>
      `).join('');
    }

    // ===== TRACK ORDER WITH MAP =====
    function trackOrder(orderId) {
      const order = orders.find(o => o.id === orderId);
      if (!order) return;
      
      document.getElementById('mapCard').style.display = 'block';
      
      // Initialize map if not already
      if (!map) {
        map = L.map('map').setView([12.3051, 76.6551], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);
      }
      
      // Clear existing markers
      map.eachLayer((layer) => {
        if (layer instanceof L.Marker) {
          map.removeLayer(layer);
        }
      });
      
      // Add markers
      const customerLoc = [12.3051, 76.6551]; // Mysore coordinates
      const teamLoc = [12.2951, 76.6451]; // Slightly offset
      
      L.marker(customerLoc).addTo(map)
        .bindPopup('Your Location')
        .openPopup();
      
      const teamMarker = L.marker(teamLoc).addTo(map)
        .bindPopup('Installation Team');
      
      // Calculate ETA
      const eta = Math.floor(Math.random() * 30) + 15;
      document.getElementById('etaInfo').innerHTML = `
        <strong>ETA:</strong> ${eta} minutes<br>
        <strong>Order:</strong> ${order.id}<br>
        <strong>Status:</strong> Team is on the way
      `;
           
      // Animate team marker
      let angle = 0;
      setInterval(() => {
        angle += 0.01;
        const newLat = 12.2951 + Math.sin(angle) * 0.01;
        const newLng = 76.6451 + Math.cos(angle) * 0.01;
        teamMarker.setLatLng([newLat, newLng]);
      }, 1000);
      
      showToast(`Tracking order ${orderId}`);
    }

    // ===== PLACE NEW ORDER =====
    document.getElementById('orderForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const product = document.getElementById('productType').value;
      const quantity = parseInt(document.getElementById('quantity').value);
      const location = document.getElementById('location').value;
      const address = document.getElementById('address').value;
      const date = document.getElementById('orderDate').value;
      
      // Calculate price
      let pricePerSqFt = 399;
      if (product.includes('Aluminum')) pricePerSqFt = 599;
      else if (product.includes('Magnetic')) pricePerSqFt = 899;
      else if (product.includes('Sliding')) pricePerSqFt = 999;
      
      const amount = pricePerSqFt * quantity;
      const gst = amount * 0.18;
      const total = amount + gst;
      
      const orderId = 'ORD' + Date.now().toString().slice(-6);
      
      const newOrder = {
        id: orderId,
        product: product,
        quantity: quantity,
        location: location,
        address: address,
        date: date,
        amount: amount,
        gst: gst,
        total: total,
        status: 'pending',
        createdAt: new Date().toISOString()
      };
      
      orders.push(newOrder);
      localStorage.setItem(`orders_${currentUser.id}`, JSON.stringify(orders));
      
      // Create payment record
      const payment = {
        id: 'PAY' + Date.now().toString().slice(-6),
        orderId: orderId,
        amount: total,
        status: 'pending',
        dueDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString()
      };
      
      payments.push(payment);
      localStorage.setItem(`payments_${currentUser.id}`, JSON.stringify(payments));
      
      showToast('Order placed successfully! Order ID: ' + orderId);
      updateStats();
      displayOrders();
      displayPendingPayments();
      
      // Reset form
      this.reset();
      showSection('trackOrders');
    });

    // ===== CANCEL ORDER =====
    function cancelOrder(orderId) {
      if (confirm('Are you sure you want to cancel this order?')) {
        const index = orders.findIndex(o => o.id === orderId);
        if (index !== -1) {
          orders[index].status = 'cancelled';
          localStorage.setItem(`orders_${currentUser.id}`, JSON.stringify(orders));
          showToast('Order cancelled');
          displayOrders();
          updateStats();
        }
      }
    }

    // ===== VIEW ORDER DETAILS =====
    function viewOrderDetails(orderId) {
      const order = orders.find(o => o.id === orderId);
      if (!order) return;
      
      const details = `
        Order ID: ${order.id}
        Product: ${order.product}
        Quantity: ${order.quantity} sq ft
        Amount: ‚Çπ${order.amount}
        GST (18%): ‚Çπ${order.gst}
        Total: ‚Çπ${order.total}
        Location: ${order.location}
        Date: ${order.date}
        Status: ${order.status}
      `;
      
      showToast('Order details - Check console');
      console.log(details);
    }

    // ===== DISPLAY PENDING PAYMENTS =====
    function displayPendingPayments() {
      const pending = payments.filter(p => p.status === 'pending');
      const container = document.getElementById('pendingPayments');
      
      if (pending.length === 0) {
        container.innerHTML = '<p>No pending payments</p>';
        return;
      }
      
      container.innerHTML = pending.map(p => `
        <div class="order-item">
          <p><strong>Order:</strong> ${p.orderId}</p>
          <p><strong>Amount:</strong> ‚Çπ${p.amount}</p>
          <p><strong>Due:</strong> ${new Date(p.dueDate).toLocaleDateString()}</p>
          <button class="btn" onclick="payNow('${p.id}')" style="margin-top: 10px;">
            Pay Now
          </button>
        </div>
      `).join('');
      
      // Payment history
      const completed = payments.filter(p => p.status === 'completed');
      const historyEl = document.getElementById('paymentHistory');
      if (completed.length > 0) {
        historyEl.innerHTML = '<h4>Payment History</h4>' + completed.map(p => `
          <p>${p.orderId}: ‚Çπ${p.amount} paid on ${new Date(p.paidDate).toLocaleDateString()}</p>
        `).join('');
      }
    }

    // ===== PROCESS PAYMENT =====
    function processPayment(method) {
      const pending = payments.find(p => p.status === 'pending');
      if (!pending) {
        showToast('No pending payments');
        return;
      }
      
      // Simulate payment processing
      showToast(`Processing payment via ${method}...`);
      
      setTimeout(() => {
        pending.status = 'completed';
        pending.paidDate = new Date().toISOString();
        pending.method = method;
        
        localStorage.setItem(`payments_${currentUser.id}`, JSON.stringify(payments));
        
        showToast(`Payment successful via ${method}!`);
        displayPendingPayments();
        updateStats();
      }, 2000);
    }

    function payNow(paymentId) {
      showSection('payments');
      showToast('Select payment method');
    }

    // ===== INIT CALENDAR =====
    function initCalendar() {
      const calendarEl = document.getElementById('calendar');
      if (!calendarEl) return;
      
      calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        events: appointments.map(a => ({
          title: a.purpose,
          start: a.date + 'T' + a.time,
          allDay: false
        }))
      });
      
      calendar.render();
    }

    // ===== BOOK APPOINTMENT =====
    document.getElementById('appointmentForm')?.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const date = document.getElementById('appointmentDate').value;
      const time = document.getElementById('appointmentTime').value;
      const purpose = document.getElementById('purpose').value;
      
      const appointment = {
        id: 'APT' + Date.now().toString().slice(-6),
        date: date,
        time: time,
        purpose: purpose,
        status: 'scheduled',
        createdAt: new Date().toISOString()
      };
      
      appointments.push(appointment);
      localStorage.setItem(`appointments_${currentUser.id}`, JSON.stringify(appointments));
      
      showToast('Appointment booked successfully!');
      displayUpcomingAppointments();
      
      if (calendar) {
        calendar.addEvent({
          title: purpose,
          start: date + 'T' + time,
          allDay: false
        });
      }
      
      this.reset();
    });

    // ===== DISPLAY UPCOMING APPOINTMENTS =====
    function displayUpcomingAppointments() {
      const upcoming = appointments.filter(a => a.status === 'scheduled');
      const container = document.getElementById('upcomingAppointments');
      
      if (upcoming.length === 0) {
        container.innerHTML = '<p>No upcoming appointments</p>';
        return;
      }
      
      container.innerHTML = '<h4>Upcoming Appointments</h4>' + upcoming.map(a => `
        <div class="order-item">
          <p><strong>${a.purpose}</strong></p>
          <p>üìÖ ${new Date(a.date).toLocaleDateString()} at ${a.time}</p>
          <button onclick="cancelAppointment('${a.id}')" style="background: none; border: none; color: #ff4757; cursor: pointer;">
            Cancel
          </button>
        </div>
      `).join('');
    }

    // ===== CANCEL APPOINTMENT =====
    function cancelAppointment(appointmentId) {
      if (confirm('Cancel this appointment?')) {
        const index = appointments.findIndex(a => a.id === appointmentId);
        if (index !== -1) {
          appointments[index].status = 'cancelled';
          localStorage.setItem(`appointments_${currentUser.id}`, JSON.stringify(appointments));
          showToast('Appointment cancelled');
          displayUpcomingAppointments();
        }
      }
    }

    // ===== DISPLAY SERVICE HISTORY =====
    function displayServiceHistory() {
      const container = document.getElementById('serviceHistory');
      
      if (services.length === 0) {
        services = [
          {
            id: 'SRV001',
            type: 'Installation',
            date: '2024-01-15',
            status: 'completed',
            rating: 5
          },
          {
            id: 'SRV002',
            type: 'Maintenance',
            date: '2024-02-01',
            status: 'completed',
            rating: 4
          }
        ];
        localStorage.setItem(`services_${currentUser.id}`, JSON.stringify(services));
      }
      
      container.innerHTML = services.map(s => `
        <div class="service-item">
          <div class="service-icon">
            <i class="fas fa-wrench"></i>
          </div>
          <div class="service-details">
            <h4>${s.type}</h4>
            <p>${new Date(s.date).toLocaleDateString()}</p>
          </div>
          <span class="service-status status-${s.status}">${s.status}</span>
        </div>
      `).join('');
    }

    // ===== REQUEST QUICK SERVICE =====
    function requestQuickService() {
      const service = {
        id: 'SRV' + Date.now().toString().slice(-6),
        type: 'Quick Service',
        date: new Date().toISOString(),
        status: 'pending'
      };
      
      services.push(service);
      localStorage.setItem(`services_${currentUser.id}`, JSON.stringify(services));
      
      showToast('Service request submitted! We will contact you soon.');
      displayServiceHistory();
    }

    // ===== SUBMIT COMPLAINT =====
    document.getElementById('complaintForm')?.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const orderId = document.getElementById('complaintOrder').value;
      const type = document.getElementById('complaintType').value;
      const desc = document.getElementById('complaintDesc').value;
      const priority = document.getElementById('priority').value;
      
      const complaint = {
        id: 'CMP' + Date.now().toString().slice(-6),
        orderId: orderId || 'N/A',
        type: type,
        description: desc,
        priority: priority,
        status: 'pending',
        date: new Date().toISOString(),
        read: false
      };
      
      complaints.push(complaint);
      localStorage.setItem(`complaints_${currentUser.id}`, JSON.stringify(complaints));
      
      showToast('Complaint registered successfully! ID: ' + complaint.id);
      displayComplaintHistory();
      updateStats();
      this.reset();
    });

    // ===== DISPLAY COMPLAINT HISTORY =====
    function displayComplaintHistory() {
      const container = document.getElementById('complaintHistory');
      
      if (complaints.length === 0) {
        container.innerHTML = '<p>No complaints registered</p>';
        return;
      }
      
      container.innerHTML = '<h4>Recent Complaints</h4>' + complaints.slice(-3).map(c => `
        <div class="service-item">
          <div class="service-details">
            <h4>${c.type} (${c.priority})</h4>
            <p>${c.description.substring(0, 50)}...</p>
            <p>Status: ${c.status}</p>
          </div>
          <span class="service-status status-${c.status}">${c.status}</span>
        </div>
      `).join('');
    }

    // ===== LOYALTY PROGRAM =====
    function redeemPoints() {
      const points = parseInt(document.getElementById('loyaltyPointsDisplay').textContent);
      if (points < 100) {
        showToast('Need at least 100 points to redeem');
        return;
      }
      
      const discount = Math.floor(points / 100) * 10;
      showToast(`Redeemed for ‚Çπ${discount} discount on next order!`);
      
      // Reset points after redemption
      const newPoints = points % 100;
      document.getElementById('loyaltyPointsDisplay').textContent = newPoints;
      document.getElementById('loyaltyPoints').textContent = newPoints;
    }

    // ===== REFERRAL PROGRAM =====
    function copyReferral() {
      const code = document.getElementById('referralCode').textContent;
      navigator.clipboard.writeText(code).then(() => {
        showToast('Referral code copied!');
        
        // Simulate referral earning
        const earnings = parseInt(document.getElementById('referralEarnings').textContent.replace(/[^0-9]/g, ''));
        document.getElementById('referralEarnings').textContent = `Earned: ‚Çπ${earnings + 50}`;
      });
    }

    // ===== AVATAR FUNCTIONS =====
    function openAvatarModal() {
      document.getElementById('avatarModal').classList.add('active');
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }

    function selectAvatar(animal) {
      const url = `https://api.dicebear.com/7.x/avataaars/svg?seed=${animal}`;
      document.getElementById('avatarImage').src = url;
      
      currentUser.avatar = url;
      localStorage.setItem('currentUser', JSON.stringify(currentUser));
      
      showToast(`Avatar updated to ${animal}!`);
      closeModal('avatarModal');
    }

    function uploadPhoto() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function(event) {
          document.getElementById('avatarImage').src = event.target.result;
          
          currentUser.avatar = event.target.result;
          localStorage.setItem('currentUser', JSON.stringify(currentUser));
          
          showToast('Photo uploaded!');
          closeModal('avatarModal');
        };
        reader.readAsDataURL(file);
      };
      input.click();
    }

    // ===== CHANGE COVER =====
    function changeCover() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function(event) {
          document.getElementById('coverImage').src = event.target.result;
          document.getElementById('coverImage').style.display = 'block';
          
          currentUser.cover = event.target.result;
          localStorage.setItem('currentUser', JSON.stringify(currentUser));
          
          showToast('Cover photo updated!');
        };
        reader.readAsDataURL(file);
      };
      input.click();
    }

    // ===== SHOW/HIDE SECTIONS =====
    function showSection(section) {
      // Hide all sections
      document.getElementById('newOrderCard').style.display = 'none';
      document.getElementById('trackOrdersCard').style.display = 'none';
      document.getElementById('mapCard').style.display = 'none';
      document.getElementById('paymentsCard').style.display = 'none';
      document.getElementById('appointmentsCard').style.display = 'none';
      document.getElementById('servicesCard').style.display = 'none';
      document.getElementById('complaintsCard').style.display = 'none';
      document.getElementById('loyaltyCard').style.display = 'none';
      document.getElementById('referralsCard').style.display = 'none';
      
      // Show selected section
      switch(section) {
        case 'newOrder':
          document.getElementById('newOrderCard').style.display = 'block';
          break;
        case 'trackOrders':
          document.getElementById('trackOrdersCard').style.display = 'block';
          displayOrders();
          break;
        case 'payments':
          document.getElementById('paymentsCard').style.display = 'block';
          displayPendingPayments();
          break;
        case 'appointments':
          document.getElementById('appointmentsCard').style.display = 'block';
          if (calendar) calendar.render();
          break;
        case 'services':
          document.getElementById('servicesCard').style.display = 'block';
          displayServiceHistory();
          break;
        case 'complaints':
          document.getElementById('complaintsCard').style.display = 'block';
          displayComplaintHistory();
          break;
        case 'loyalty':
          document.getElementById('loyaltyCard').style.display = 'block';
          break;
        case 'referrals':
          document.getElementById('referralsCard').style.display = 'block';
          break;
      }
    }

    // ===== REFRESH ORDERS =====
    function refreshOrders() {
      loadAllData();
      showToast('Orders refreshed');
    }

    // ===== SHOW NOTIFICATIONS =====
    function showNotifications() {
      const unread = complaints.filter(c => !c.read);
      
      if (unread.length === 0) {
        showToast('No new notifications');
        return;
      }
      
      // Mark as read
      complaints.forEach(c => c.read = true);
      localStorage.setItem(`complaints_${currentUser.id}`, JSON.stringify(complaints));
      
      document.getElementById('notificationCount').textContent = '0';
      
      let message = 'Notifications:\n';
      unread.forEach(c => {
        message += `- ${c.type} complaint: ${c.description.substring(0, 30)}...\n`;
      });
      
      showToast(message);
    }

    // ===== LOGOUT =====
    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem('currentUser');
        sessionStorage.removeItem('currentUser');
        window.location.href = 'customer-login.html';
      }
    }

    // ===== TOAST =====
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // ===== MAKE FUNCTIONS GLOBAL =====
    window.showSection = showSection;
    window.trackOrder = trackOrder;
    window.cancelOrder = cancelOrder;
    window.viewOrderDetails = viewOrderDetails;
    window.processPayment = processPayment;
    window.payNow = payNow;
    window.cancelAppointment = cancelAppointment;
    window.requestQuickService = requestQuickService;
    window.redeemPoints = redeemPoints;
    window.copyReferral = copyReferral;
    window.openAvatarModal = openAvatarModal;
    window.closeModal = closeModal;
    window.selectAvatar = selectAvatar;
    window.uploadPhoto = uploadPhoto;
    window.changeCover = changeCover;
    window.refreshOrders = refreshOrders;
    window.showNotifications = showNotifications;
    window.logout = logout;
  </script>
</body>
</html>
```
